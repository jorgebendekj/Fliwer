!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e,t,i,r){Object.defineProperty(e,t,{get:i,set:r,enumerable:!0,configurable:!0})}var i=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3,r=i.register;r("2SNZp",(function(r,n){t(r.exports,"supportsUploadFeature",(function(){return M})),t(r.exports,"default",(function(){return A}));var o=i("4mVfk"),a=i("uqRmf"),s=i("eVDe4"),u=i("lwdaQ"),c=i("h4cnL"),h=i("3BD5g"),d=i("ck3YL"),f=i("lH0U2"),l=i("kFnE9"),m=i("8DpVo"),p=i("dClYm"),v=i("hu37m"),y=i("akORO"),g=i("cODgg"),k=i("ax6lg"),j=i("lWLaw"),R=i("ge10A"),E=i("cplTD"),w=i("aNiAa"),I=i("5FLyW");function b(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function S(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?b(Object(r),!0).forEach((function(i){e(l)(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function O(t){var i=T();return function(){var r,n=e(f)(t);if(i){var o=e(f)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return e(d)(this,r)}}function T(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(T=function(){return!!e})()}var M=function(e){var t=e;return!!t.isUploadSupported&&!!t.uploadCustomEmoji&&!!t.prepareForUpload},x=function(t){e(h)(M,t);var i,r,n,d,b,T=O(M);function M(t){var i;if(e(a)(this,M),i=T.call(this),e(l)(e(u)(i),"activeLoaders",0),e(l)(e(u)(i),"initialLoaders",0),e(l)(e(u)(i),"retries",new Map),e(l)(e(u)(i),"isInitialised",!1),e(l)(e(u)(i),"fetchOnDemand",!1),e(l)(e(u)(i),"getOptimisticImageURL",(function(e){if(i.emojiProviderConfig.optimisticImageApi)return i.emojiProviderConfig.optimisticImageApi.getUrl(e)})),e(l)(e(u)(i),"isRepositoryAvailable",(function(e){return!!e})),e(l)(e(u)(i),"isLoaded",(function(){return 0!==i.initialLoaders&&0===i.activeLoaders})),i.emojiProviderConfig=t,i.recordConfig=t.recordConfig,i.currentUser=t.currentUser,(0,k.default)("localStorage")&&(i.selectedTone=i.loadStoredTone()),0===t.providers.length)throw new Error("No providers specified");return i.fetchOnDemand=!!t.options&&!!t.options.onlyFetchOnDemand,i.initialLoaders=i.emojiProviderConfig.providers.length,i.activeLoaders=i.emojiProviderConfig.providers.length,i.emojiResponses=[],i}return e(s)(M,[{key:"getEmojiProvider",value:(b=e(o)(e(m).mark((function t(){var i=arguments;return e(m).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i.length>0&&void 0!==i[0]?i[0]:{fetchAtStart:!this.fetchOnDemand}).fetchAtStart){e.next=11;break}return e.prev=2,e.next=5,this.fetchEmojiProvider();case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(2),(0,y.default)(e.t0),e.abrupt("return",Promise.resolve(this));case 11:return e.abrupt("return",Promise.resolve(this));case 12:case"end":return e.stop()}}),t,this,[[2,7]])}))),function(){return b.apply(this,arguments)})},{key:"fetchIndividualProvider",value:(d=e(o)(e(m).mark((function t(i,r){var n,o,a;return e(m).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.getProviderType(i),e.prev=1,(0,I.sampledUfoEmojiResourceFetched)(n).start({samplingRate:v.SAMPLING_RATE_EMOJI_RESOURCE_FETCHED_EXP}),(0,I.sampledUfoEmojiResourceFetched)(n).addMetadata({type:n}),o=new(0,R.default)(i),e.next=7,o.loadEmoji();case 7:return a=e.sent,(0,I.sampledUfoEmojiResourceFetched)(n).success(),this.emojiResponses[r]=a,this.initEmojiRepository(this.emojiResponses),e.next=13,this.initSiteEmojiResource(a,i);case 13:this.activeLoaders--,this.performRetries(),this.refreshLastFilter(),e.next=25;break;case 18:throw e.prev=18,e.t0=e.catch(1),this.activeLoaders--,this.notifyError(e.t0),(0,I.sampledUfoEmojiResourceFetched)(n).failure({metadata:{reason:e.t0,source:"EmojiProvider",providerUrl:i.url}}),(0,y.default)("failed to fetch emoji provider for ".concat(i.url),e.t0),new Error("failed to fetch emoji from ".concat(i.url));case 25:case"end":return e.stop()}}),t,this,[[1,18]])}))),function(e,t){return d.apply(this,arguments)})},{key:"fetchEmojiProvider",value:(n=e(o)(e(m).mark((function t(){var i=this,r=arguments;return e(m).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.length>0&&void 0!==r[0]&&r[0])&&(this.isRepositoryAvailable(this.emojiRepository)||this.isInitialised)){e.next=6;break}return this.isInitialised=!0,this.emojiResponses=[],e.next=6,Promise.all(this.emojiProviderConfig.providers.map((function(e,t){return i.fetchIndividualProvider(e,t)})));case 6:return e.abrupt("return",Promise.resolve(this.emojiRepository));case 7:case"end":return e.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"onlyFetchOnDemand",value:function(){return this.fetchOnDemand}},{key:"fetchByEmojiId",value:(r=e(o)(e(m).mark((function t(i,r){var n,o,a,s,u,c;return e(m).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoaded()||!this.isRepositoryAvailable(this.emojiRepository)){e.next=8;break}return e.next=3,this.findByEmojiId(i);case 3:if(!(n=e.sent)){e.next=8;break}return e.next=7,this.getMediaEmojiDescriptionURLWithInlineToken(n);case 7:return e.abrupt("return",e.sent);case 8:if(!this.emojiProviderConfig.singleEmojiApi||!r){e.next=31;break}return o={url:this.emojiProviderConfig.singleEmojiApi.getUrl(i),securityProvider:this.emojiProviderConfig.singleEmojiApi.securityProvider},a=new(0,R.default)(o),e.prev=11,e.next=14,a.loadEmoji();case 14:if((s=e.sent).emojis[0]){e.next=17;break}return e.abrupt("return");case 17:if(this.isRepositoryAvailable(this.siteEmojiResource)){e.next=20;break}return e.next=20,this.initSiteEmojiResource(s,o);case 20:return e.abrupt("return",this.getMediaEmojiDescriptionURLWithInlineToken(s.emojis[0]));case 23:return e.prev=23,e.t0=e.catch(11),e.next=27,this.findByEmojiId(i);case 27:if(u=e.sent){e.next=30;break}return e.abrupt("return");case 30:return e.abrupt("return",this.getMediaEmojiDescriptionURLWithInlineToken(u));case 31:return e.next=33,this.findByEmojiId(i);case 33:if(c=e.sent){e.next=36;break}return e.abrupt("return");case 36:return e.abrupt("return",this.getMediaEmojiDescriptionURLWithInlineToken(c));case 37:case"end":return e.stop()}}),t,this,[[11,23]])}))),function(e,t){return r.apply(this,arguments)})},{key:"getProviderType",value:function(e){return e.url.includes("/site")?j.ProviderTypes.SITE:e.url.includes("/standard")?j.ProviderTypes.STANDARD:e.url.includes("/atlassian")?j.ProviderTypes.ATLASSIAN:j.ProviderTypes.UNKNOWN}},{key:"initEmojiRepository",value:function(e){var t=[];e.forEach((function(e){t=t.concat(e.emojis)})),this.emojiRepository=new(0,E.default)(t)}},{key:"initSiteEmojiResource",value:function(e,t){if(!this.isRepositoryAvailable(this.siteEmojiResource)&&e.mediaApiToken){this.siteEmojiResource=new(0,w.default)(t,e.mediaApiToken);var i=e.emojis;if(i.length){var r=this.siteEmojiResource.optimisticRendering(i[0]);if((0,g.isPromise)(r))return r.then((function(){(0,y.default)("Primed siteEmojiResource")})).catch((function(){(0,y.default)("Failed to prime siteEmojiResource")}));(0,y.default)("Already primed siteEmojiResource")}else(0,y.default)("No emoji to prime siteEmojiResource with")}return Promise.resolve()}},{key:"performRetries",value:function(){var e=this.retries;this.retries=new Map,e.forEach((function(e,t){var i=t();(0,g.isPromise)(i)?i.then((function(t){e.resolve(t)})).catch((function(t){e.reject(t)})):e.resolve(i)}))}},{key:"loadStoredTone",value:function(){if("undefined"!=typeof window){var e=window.localStorage.getItem(v.selectedToneStorageKey);if(e){var t=parseInt(e,10);return isNaN(t)?void 0:t}}}},{key:"refreshLastFilter",value:function(){if(void 0!==this.lastQuery){var e=this.lastQuery,t=e.query,i=e.options;this.filter(t,i)}}},{key:"retryIfLoading",value:function(e,t){var i=this;return this.isLoaded()?Promise.resolve(t):new Promise((function(t,r){i.retries.set(e,{resolve:t,reject:r})}))}},{key:"notifyResult",value:function(t){this.lastQuery&&t.query===this.lastQuery.query&&e(c)(e(f)(M.prototype),"notifyResult",this).call(this,t)}},{key:"getMediaEmojiDescriptionURLWithInlineToken",value:(i=e(o)(e(m).mark((function t(i){var r,n,o;return e(m).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRepositoryAvailable(this.siteEmojiResource)){e.next=7;break}return e.next=3,this.siteEmojiResource.generateTokenisedMediaURLS(i.representation,i.altRepresentation);case 3:return r=e.sent,n=r.representation,o=r.altRepresentation,e.abrupt("return",S(S({},i),{},{representation:n,altRepresentation:o}));case 7:return e.abrupt("return",i);case 8:case"end":return e.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadMediaEmoji",value:function(e,t){return this.isRepositoryAvailable(this.siteEmojiResource)&&(0,g.isMediaEmoji)(e)?this.siteEmojiResource.loadMediaEmoji(e,t):e}},{key:"optimisticMediaRendering",value:function(e,t){if(!(0,g.isMediaEmoji)(e))return!0;if(!this.isRepositoryAvailable(this.siteEmojiResource))return!1;var i=this.siteEmojiResource.optimisticRendering(e,t);return!(0,g.isPromise)(i)&&i}},{key:"filter",value:function(e,t){if(I.ufoExperiences["emoji-searched"].start(),I.ufoExperiences["emoji-searched"].addMetadata({queryLength:(null==e?void 0:e.length)||0}),this.lastQuery={query:e,options:t},this.isRepositoryAvailable(this.emojiRepository)){var i=this.emojiRepository.search(e,t);this.notifyResult(i),I.ufoExperiences["emoji-searched"].success({metadata:{emojisLength:i.emojis.length,source:(null==t?void 0:t.source)||"typeahead"}})}else this.notifyNotReady()}},{key:"findByShortName",value:function(e){var t=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?this.emojiRepository.findByShortName(e):this.retryIfLoading((function(){return t.findByShortName(e)}),void 0)}},{key:"findByEmojiId",value:function(e){var t=this,i=e.id,r=e.shortName;if(this.isRepositoryAvailable(this.emojiRepository)){if(!i)return this.findByShortName(r);var n=this.emojiRepository.findById(i);if(n)return n;if(this.isLoaded())return this.isRepositoryAvailable(this.siteEmojiResource)?this.siteEmojiResource.findEmoji(e).then((function(e){return e?(t.addUnknownEmoji(e),e):t.findByShortName(r)})):this.findByShortName(r)}return this.retryIfLoading((function(){return t.findByEmojiId(e)}),void 0)}},{key:"findById",value:function(e){var t=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?this.emojiRepository.findById(e):this.retryIfLoading((function(){return t.findById(e)}),void 0)}},{key:"findInCategory",value:function(e){var t=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?Promise.resolve(this.emojiRepository.findInCategory(e)):this.retryIfLoading((function(){return t.findInCategory(e)}),[])}},{key:"getAsciiMap",value:function(){var e=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?Promise.resolve(this.emojiRepository.getAsciiMap()):this.retryIfLoading((function(){return e.getAsciiMap()}),new Map)}},{key:"getFrequentlyUsed",value:function(e){var t=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?Promise.resolve(this.emojiRepository.getFrequentlyUsed(e)):this.retryIfLoading((function(){return t.getFrequentlyUsed(e)}),[])}},{key:"recordSelection",value:function(e){var t=this.recordConfig;if(this.isRepositoryAvailable(this.emojiRepository)&&this.emojiRepository.used(e),t){var i={emojiId:(0,g.toEmojiId)(e)};return p.utils.requestService(t,{queryParams:i,requestInit:{method:"POST"}})}return Promise.resolve()}},{key:"deleteSiteEmoji",value:function(e){var t=this;return this.isRepositoryAvailable(this.siteEmojiResource)&&e.id?this.siteEmojiResource.deleteEmoji(e).then((function(i){return!(!i||!t.isRepositoryAvailable(t.emojiRepository))&&(t.emojiRepository.delete(e),!0)})).catch((function(e){return console.error("failed to delete site emoji",e),!1})):this.retryIfLoading((function(){return t.deleteSiteEmoji(e)}),!1)}},{key:"getSelectedTone",value:function(){return this.selectedTone}},{key:"setSelectedTone",value:function(e){if(this.selectedTone=e,"undefined"!=typeof window&&(0,k.default)("localStorage"))try{window.localStorage.setItem(v.selectedToneStorageKey,e?e.toString():"")}catch(e){console.error("failed to store selected emoji skin tone",e)}}},{key:"calculateDynamicCategories",value:function(){var e=this;return this.isLoaded()&&this.isRepositoryAvailable(this.emojiRepository)?Promise.resolve(this.emojiRepository.getDynamicCategoryList()):this.retryIfLoading((function(){return e.calculateDynamicCategories()}),[])}},{key:"getCurrentUser",value:function(){return this.currentUser}},{key:"addUnknownEmoji",value:function(e){this.isRepositoryAvailable(this.emojiRepository)&&this.emojiRepository.addUnknownEmoji(e)}}]),M}(p.AbstractResource),A=function(t){e(h)(r,t);var i=O(r);function r(t){var n;return e(a)(this,r),(n=i.call(this,t)).allowUpload=!!t.allowUpload,n}return e(s)(r,[{key:"isUploadSupported",value:function(){var e=this;return this.allowUpload?this.isRepositoryAvailable(this.siteEmojiResource)?this.siteEmojiResource.hasUploadToken():this.retryIfLoading((function(){return e.isUploadSupported()}),!1):Promise.resolve(!1)}},{key:"uploadCustomEmoji",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.isUploadSupported().then((function(r){return r&&t.isRepositoryAvailable(t.siteEmojiResource)?t.siteEmojiResource.uploadEmoji(e,i).then((function(i){return i.representation.imagePath=e.dataURL,t.addUnknownEmoji(i),t.refreshLastFilter(),i})):Promise.reject("No media api support is configured")}))}},{key:"prepareForUpload",value:function(){var e=this;return this.isRepositoryAvailable(this.siteEmojiResource)&&this.siteEmojiResource.prepareForUpload(),this.retryIfLoading((function(){return e.prepareForUpload()}),void 0)}}]),r}(x)})),r("ax6lg",(function(e,i){function r(e){if("undefined"==typeof window)return!1;var t;try{t=window[e];var i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&t&&0!==t.length}}t(e.exports,"default",(function(){return r}))})),r("ge10A",(function(r,n){t(r.exports,"default",(function(){return u}));var o=i("uqRmf"),a=i("eVDe4"),s=i("aRoNj"),u=function(){function t(i){e(o)(this,t),this.config=i}return e(a)(t,[{key:"loadEmoji",value:function(){return(0,s.emojiRequest)(this.config).then((function(e){return(0,s.denormaliseEmojiServiceResponse)(e)}))}}]),t}()})),r("cplTD",(function(r,n){t(r.exports,"getEmojiVariation",(function(){return k})),t(r.exports,"default",(function(){return j}));var o=i("b4Ivn"),a=i("kFnE9"),s=i("uqRmf"),u=i("eVDe4"),c=i("6Nyrg"),h=i("hu37m"),d=i("cODgg"),f=i("lWLaw"),l=i("fMcYA"),m=i("9p5wF"),p=i("41EFR"),v=function(){function t(){e(s)(this,t)}return e(u)(t,[{key:"tokenize",value:function(e){return this.tokenizeAsTokens(e).map((function(e){return e.token}))}},{key:"tokenizeAsTokens",value:function(e){var t,i=[];for(l.tokenizerRegex.lastIndex=0;null!==(t=l.tokenizerRegex.exec(e));)t[0]&&i.push({token:t[0],start:t.index});return i}}]),t}(),y=function e(t,i,r){var n=i(t);r.has(n)||r.set(n,[]);var o=r.get(n);if(o&&o.push(t),(0,d.isEmojiDescriptionWithVariations)(t)){var a=t.skinVariations;a&&a.forEach((function(t){return e(t,i,r)}))}},g=function(e,t){var i=e.get(t);if(i&&i.length)return i[i.length-1]},k=function(e,t){if((0,d.isEmojiDescriptionWithVariations)(e)&&t){var i=t.skinTone;if(i&&e.skinVariations&&e.skinVariations.length){var r=e.skinVariations[i-1];if(r)return r}}return e},j=function(){function t(i,r){e(s)(this,t),this.emojis=i,this.initMembers(r)}return e(u)(t,[{key:"all",value:function(){var e={sort:f.SearchSort.None};return this.search("",e)}},{key:"search",value:function(e,t){var i=[],r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return 0===e.indexOf(":")?{nameQuery:e.slice(1),asciiQuery:e}:{nameQuery:e,asciiQuery:""}}(e),n=r.nameQuery,o=r.asciiQuery;return n?(i=this.fullSearch.search(n),o&&(i=this.withAsciiMatch(o,i))):i=this.getAllSearchableEmojis(),{emojis:i=this.applySearchOptions(i,e,t),query:e}}},{key:"findAllMatchingShortName",value:function(e){return this.shortNameMap.get(e)||[]}},{key:"findByShortName",value:function(e){return g(this.shortNameMap,e)}},{key:"findById",value:function(e){return g(this.idMap,e)}},{key:"findByAsciiRepresentation",value:function(e){return this.asciiMap.get(e)}},{key:"findInCategory",value:function(e){return e===h.frequentCategory?this.getFrequentlyUsed():this.all().emojis.filter((function(t){return t.category===e}))}},{key:"addUnknownEmoji",value:function(t){this.emojis=[].concat(e(o)(this.emojis),[t]),this.fullSearch.addDocuments([t]),this.addToMaps(t),this.addToDynamicCategories(t)}},{key:"getAsciiMap",value:function(){return this.asciiMap}},{key:"getFrequentlyUsed",value:function(e){var t=this,i=this.usageTracker.getOrder().map((function(e){return t.findById(e)})).filter((function(e){return void 0!==e}));return e&&(i=this.applySearchOptions(i,"",e)),i}},{key:"getDynamicCategoryList",value:function(){return this.dynamicCategoryList.slice()}},{key:"used",value:function(e){var t=this;if(this.usageTracker.recordUsage(e),-1===this.dynamicCategoryList.indexOf(h.frequentCategory)){if("undefined"==typeof window)return;window.setTimeout((function(){t.dynamicCategoryList.push(h.frequentCategory)}))}}},{key:"delete",value:function(e){var t,i,r,n,o=(t=this.emojis,r=(i=e).id,n=-1,t.forEach((function(e,t){(e.id&&e.id===r||!e.id&&!r&&e.shortName===i.shortName)&&(n=t)})),n);-1!==o&&(this.emojis.splice(o,1),this.initMembers(this.usageTracker))}},{key:"withAsciiMatch",value:function(t,i){var r=i,n=this.findByAsciiRepresentation(t);return n&&(r=i.filter((function(e){return e.id!==n.id})),r=[n].concat(e(o)(r))),r}},{key:"applySearchOptions",value:function(e,t,i){var r;return i||(i={}),void 0===i.sort&&(i.sort=f.SearchSort.Default),i.sort===f.SearchSort.Default?r=(0,m.createSearchEmojiComparator)(t,this.usageTracker.getOrder()):i.sort===f.SearchSort.UsageFrequency&&(r=(0,m.createUsageOnlyEmojiComparator)(this.usageTracker.getOrder())),r&&(r.compare=r.compare.bind(r),e=e.sort(r.compare)),i.limit&&i.limit>0&&(e=e.slice(0,i.limit)),i.skinTone?e.map((function(e){return k(e,i)})):e}},{key:"initMembers",value:function(e){this.usageTracker=e||new(0,p.UsageFrequencyTracker),this.initRepositoryMetadata(),this.initSearchIndex()}},{key:"initRepositoryMetadata",value:function(){var e=this;this.shortNameMap=new Map,this.idMap=new Map,this.asciiMap=new Map;var t=new Set;this.emojis.forEach((function(i){t.add(i.category),e.addToMaps(i)})),this.usageTracker.getOrder().length&&t.add(h.frequentCategory),this.dynamicCategoryList=Array.from(t).filter((function(e){return-1===h.defaultCategories.indexOf(e)}))}},{key:"initSearchIndex",value:function(){this.fullSearch=new(0,c.Search)("id"),this.fullSearch.tokenizer=new v,this.fullSearch.searchIndex=new(0,c.UnorderedSearchIndex),this.fullSearch.addIndex("name"),this.fullSearch.addIndex("shortName"),this.fullSearch.addDocuments(this.getAllSearchableEmojis())}},{key:"getAllSearchableEmojis",value:function(){return this.emojis.filter((function(e){return e.searchable}))}},{key:"addToMaps",value:function(e){var i=this;void 0!==e.order&&-1!==e.order||(e.order=t.defaultEmojiWeight),void 0===e.id&&(e.id=t.defaultEmojiWeight.toString()),y(e,(function(e){return e.shortName}),this.shortNameMap),y(e,(function(e){return e.id}),this.idMap),e.ascii&&e.ascii.forEach((function(t){return i.asciiMap.set(t,e)}))}},{key:"addToDynamicCategories",value:function(e){var t=(0,d.getCategoryId)(e);-1===h.defaultCategories.indexOf(t)&&-1===this.dynamicCategoryList.indexOf(t)&&this.dynamicCategoryList.push(t)}}]),t}();e(a)(j,"defaultEmojiWeight",1e6)})),r("6Nyrg",(function(e,i){t(e.exports,"UnorderedSearchIndex",(function(){return s})),t(e.exports,"Search",(function(){return d}));var r=function(){function e(){}return e.prototype.expandToken=function(e){for(var t=[],i="",r=0,n=e.length;r<n;++r)i+=e.charAt(r),t.push(i);return t},e}(),n=function(){function e(){}return e.prototype.sanitize=function(e){return e?e.toLocaleLowerCase().trim():""},e}();function o(e,t){t=t||[];for(var i=e=e||{},r=0;r<t.length;r++)if(null==(i=i[t[r]]))return null;return i}var a=function(){function e(e){this._uidFieldName=e,this._tokenToIdfCache={},this._tokenMap={}}var t=e.prototype;return t.indexDocument=function(e,t,i){this._tokenToIdfCache={};var r,n=this._tokenMap;"object"!=typeof n[e]?n[e]=r={$numDocumentOccurrences:0,$totalNumOccurrences:1,$uidMap:{}}:(r=n[e]).$totalNumOccurrences++;var o=r.$uidMap;"object"!=typeof o[t]?(r.$numDocumentOccurrences++,o[t]={$document:i,$numTokenOccurrences:1}):o[t].$numTokenOccurrences++},t.search=function(e,t){for(var i={},r=0,n=e.length;r<n;r++){var o=e[r],a=this._tokenMap[o];if(!a)return[];if(0===r)for(var s=0,u=(c=Object.keys(a.$uidMap)).length;s<u;s++){i[h=c[s]]=a.$uidMap[h].$document}else{var c;for(s=0,u=(c=Object.keys(i)).length;s<u;s++){var h=c[s];"object"!=typeof a.$uidMap[h]&&delete i[h]}}}var d=[];for(var h in i)d.push(i[h]);var f=this._createCalculateTfIdf();return d.sort((function(i,r){return f(e,r,t)-f(e,i,t)}))},t._createCalculateIdf=function(){var e=this._tokenMap,t=this._tokenToIdfCache;return function(i,r){if(!t[i]){var n=void 0!==e[i]?e[i].$numDocumentOccurrences:0;t[i]=1+Math.log(r.length/(1+n))}return t[i]}},t._createCalculateTfIdf=function(){var e=this._tokenMap,t=this._uidFieldName,i=this._createCalculateIdf();return function(r,n,a){for(var s=0,u=0,c=r.length;u<c;++u){var h,d=r[u],f=i(d,a);f===1/0&&(f=0),h=t instanceof Array?n&&o(n,t):n&&n[t],s+=(void 0!==e[d]&&void 0!==e[d].$uidMap[h]?e[d].$uidMap[h].$numTokenOccurrences:0)*f}return s}},e}(),s=function(){function e(){this._tokenToUidToDocumentMap={}}var t=e.prototype;return t.indexDocument=function(e,t,i){"object"!=typeof this._tokenToUidToDocumentMap[e]&&(this._tokenToUidToDocumentMap[e]={}),this._tokenToUidToDocumentMap[e][t]=i},t.search=function(e,t){for(var i={},r=this._tokenToUidToDocumentMap,n=0,o=e.length;n<o;n++){var a=r[e[n]];if(!a)return[];if(0===n)for(var s=0,u=(c=Object.keys(a)).length;s<u;s++){i[d=c[s]]=a[d]}else for(s=0,u=(c=Object.keys(i)).length;s<u;s++){"object"!=typeof a[d=c[s]]&&delete i[d]}}var c,h=[];for(n=0,u=(c=Object.keys(i)).length;n<u;n++){var d=c[n];h.push(i[d])}return h},e}(),u=/[^a-z\u0430-\u044f\u04510-9\-']+/i,c=function(){function e(){}return e.prototype.tokenize=function(e){return e.split(u).filter((function(e){return e}))},e}();function h(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(e){if(!e)throw Error("js-search requires a uid field name constructor parameter");this._uidFieldName=e,this._indexStrategy=new r,this._searchIndex=new a(e),this._sanitizer=new n,this._tokenizer=new c,this._documents=[],this._searchableFields=[]}var t,i,s,u=e.prototype;return u.addDocument=function(e){this.addDocuments([e])},u.addDocuments=function(e){this._documents=this._documents.concat(e),this.indexDocuments_(e,this._searchableFields)},u.addIndex=function(e){this._searchableFields.push(e),this.indexDocuments_(this._documents,[e])},u.search=function(e){var t=this._tokenizer.tokenize(this._sanitizer.sanitize(e));return this._searchIndex.search(t,this._documents)},u.indexDocuments_=function(e,t){this._initialized=!0;for(var i=this._indexStrategy,r=this._sanitizer,n=this._searchIndex,a=this._tokenizer,s=this._uidFieldName,u=0,c=e.length;u<c;u++){var h,d=e[u];h=s instanceof Array?o(d,s):d[s];for(var f=0,l=t.length;f<l;f++){var m,p=t[f];if(null!=(m=p instanceof Array?o(d,p):d[p])&&"string"!=typeof m&&m.toString&&(m=m.toString()),"string"==typeof m)for(var v=a.tokenize(r.sanitize(m)),y=0,g=v.length;y<g;y++)for(var k=v[y],j=i.expandToken(k),R=0,E=j.length;R<E;R++){var w=j[R];n.indexDocument(w,h,d)}}}},t=e,(i=[{key:"indexStrategy",set:function(e){if(this._initialized)throw Error("IIndexStrategy cannot be set after initialization");this._indexStrategy=e},get:function(){return this._indexStrategy}},{key:"sanitizer",set:function(e){if(this._initialized)throw Error("ISanitizer cannot be set after initialization");this._sanitizer=e},get:function(){return this._sanitizer}},{key:"searchIndex",set:function(e){if(this._initialized)throw Error("ISearchIndex cannot be set after initialization");this._searchIndex=e},get:function(){return this._searchIndex}},{key:"tokenizer",set:function(e){if(this._initialized)throw Error("ITokenizer cannot be set after initialization");this._tokenizer=e},get:function(){return this._tokenizer}}])&&h(t.prototype,i),s&&h(t,s),e}()})),r("fMcYA",(function(e,i){t(e.exports,"tokenizerRegex",(function(){return r}));var r=new RegExp("[\u2e80-\u2e99\u2e9b-\u2ef3\u2f00-\u2fd5\u3005\u3007\u3021-\u3029\u3038-\u303b\u3400-\u4db5\u4e00-\u9fef\uf900-\ufa6d\ufa70-\ufad9]|[A-Za-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08bd\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16f1-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u1884\u1887-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005\u3006\u3031-\u3035\u303b\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fef\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6e5\ua717-\ua71f\ua722-\ua788\ua78b-\ua7b9\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab65\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc|0-9\xb2\xb3\xb9\xbc-\xbe\u0660-\u0669\u06f0-\u06f9\u07c0-\u07c9\u0966-\u096f\u09e6-\u09ef\u09f4-\u09f9\u0a66-\u0a6f\u0ae6-\u0aef\u0b66-\u0b6f\u0b72-\u0b77\u0be6-\u0bf2\u0c66-\u0c6f\u0c78-\u0c7e\u0ce6-\u0cef\u0d58-\u0d5e\u0d66-\u0d78\u0de6-\u0def\u0e50-\u0e59\u0ed0-\u0ed9\u0f20-\u0f33\u1040-\u1049\u1090-\u1099\u1369-\u137c\u16ee-\u16f0\u17e0-\u17e9\u17f0-\u17f9\u1810-\u1819\u1946-\u194f\u19d0-\u19da\u1a80-\u1a89\u1a90-\u1a99\u1b50-\u1b59\u1bb0-\u1bb9\u1c40-\u1c49\u1c50-\u1c59\u2070\u2074-\u2079\u2080-\u2089\u2150-\u2182\u2185-\u2189\u2460-\u249b\u24ea-\u24ff\u2776-\u2793\u2cfd\u3007\u3021-\u3029\u3038-\u303a\u3192-\u3195\u3220-\u3229\u3248-\u324f\u3251-\u325f\u3280-\u3289\u32b1-\u32bf\ua620-\ua629\ua6e6-\ua6ef\ua830-\ua835\ua8d0-\ua8d9\ua900-\ua909\ua9d0-\ua9d9\ua9f0-\ua9f9\uaa50-\uaa59\uabf0-\uabf9\uff10-\uff19]+[\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065f\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u07fd\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08d3-\u08e1\u08e3-\u0902\u093a\u093c\u0941-\u0948\u094d\u0951-\u0957\u0962\u0963\u0981\u09bc\u09c1-\u09c4\u09cd\u09e2\u09e3\u09fe\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0afa-\u0aff\u0b01\u0b3c\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b62\u0b63\u0b82\u0bc0\u0bcd\u0c00\u0c04\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c81\u0cbc\u0cbf\u0cc6\u0ccc\u0ccd\u0ce2\u0ce3\u0d00\u0d01\u0d3b\u0d3c\u0d41-\u0d44\u0d4d\u0d62\u0d63\u0dca\u0dd2-\u0dd4\u0dd6\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4\u17b5\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u1885\u1886\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a1b\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1ab0-\u1abd\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1bab-\u1bad\u1be6\u1be8\u1be9\u1bed\u1bef-\u1bf1\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1cf4\u1cf8\u1cf9\u1dc0-\u1df9\u1dfb-\u1dff\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302d\u3099\u309a\ua66f\ua674-\ua67d\ua69e\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8c5\ua8e0-\ua8f1\ua8ff\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\ua9e5\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaa7c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaec\uaaed\uaaf6\uabe5\uabe8\uabed\ufb1e\ufe00-\ufe0f\ufe20-\ufe2f|']*[A-Za-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u037f\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u052f\u0531-\u0556\u0559\u0560-\u0588\u05d0-\u05ea\u05ef-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u0860-\u086a\u08a0-\u08b4\u08b6-\u08bd\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u09fc\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0af9\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c39\u0c3d\u0c58-\u0c5a\u0c60\u0c61\u0c80\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d54-\u0d56\u0d5f-\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f5\u13f8-\u13fd\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16f1-\u16f8\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1878\u1880-\u1884\u1887-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191e\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1c80-\u1c88\u1c90-\u1cba\u1cbd-\u1cbf\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2183\u2184\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005\u3006\u3031-\u3035\u303b\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312f\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fef\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua69d\ua6a0-\ua6e5\ua717-\ua71f\ua722-\ua788\ua78b-\ua7b9\ua7f7-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua8fd\ua8fe\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\ua9e0-\ua9e4\ua9e6-\ua9ef\ua9fa-\ua9fe\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa7e-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uab30-\uab5a\uab5c-\uab65\uab70-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]*","gi")})),r("9p5wF",(function(r,n){t(r.exports,"createSearchEmojiComparator",(function(){return h})),t(r.exports,"createUsageOnlyEmojiComparator",(function(){return d}));var o=i("uqRmf"),a=i("eVDe4"),s=i("fgvGZ"),u=i("hu37m"),c=i("cODgg");function h(t,i){var r=t?t.replace(/:/g,"").toLowerCase().trim():void 0,n=[];t&&n.push(new l(t)),r&&n.push(new m(r)),i&&i.length&&n.push(new v(i)),r&&n.push(new y(r,"shortName"),new y(r,"name")),n.push(g.Instance,k.Instance);var o=e(s)(f,n);return o.compare=o.compare.bind(o),o}function d(e){var t=new f(new v(e),new p,g.Instance);return t.compare=t.compare.bind(t),t}var f=function(){function t(){e(o)(this,t);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];this.chain=r}return e(a)(t,[{key:"compare",value:function(e,t){for(var i=0;i<this.chain.length;i++){var r=this.chain[i].compare(e,t);if(0!==r)return r}return 0}}]),t}(),l=function(){function t(i){e(o)(this,t),this.query=i}return e(a)(t,[{key:"compare",value:function(e,t){var i=e.ascii&&-1!==e.ascii.indexOf(this.query),r=t.ascii&&-1!==t.ascii.indexOf(this.query);return i&&!r?-1:!i&&r?1:0}}]),t}(),m=function(){function t(i){e(o)(this,t),this.colonQuery=":".concat(i,":"),this.typeComparator=new p(!0)}return e(a)(t,[{key:"compare",value:function(e,t){return e.shortName===this.colonQuery&&t.shortName===this.colonQuery?this.typeComparator.compare(e,t):e.shortName===this.colonQuery?-1:t.shortName===this.colonQuery?1:0}}]),t}(),p=function(){function t(i){e(o)(this,t),this.typeToNumber=i?new Map([["SITE",0],["ATLASSIAN",1],["STANDARD",2]]):new Map([["STANDARD",0],["ATLASSIAN",1],["SITE",2]])}return e(a)(t,[{key:"compare",value:function(e,t){return this.emojiTypeToOrdinal(e)-this.emojiTypeToOrdinal(t)}},{key:"emojiTypeToOrdinal",value:function(e){var t=this.typeToNumber.get(e.type);return void 0===t&&(t=10),t}}]),t}(),v=function(){function t(i){var r=this;e(o)(this,t),this.positionLookup=new Map,i.map((function(e,t){return r.positionLookup.set(e,t+1)}))}return e(a)(t,[{key:"compare",value:function(e,t){return e.id&&t.id?this.getPositionInOrder(e)-this.getPositionInOrder(t):0}},{key:"getPositionInOrder",value:function(e){var t=e.id?e.id:"0";(0,c.isEmojiVariationDescription)(e)&&(t=e.baseId);var i=this.positionLookup.get(t);return i||u.MAX_ORDINAL}}]),t}(),y=function(){function t(i,r){if(e(o)(this,t),this.query=i,!r)throw new Error("propertyToCompare is required");this.propertyName=r}return e(a)(t,[{key:"getScore",value:function(e){var t=e[this.propertyName],i=t?t.indexOf(this.query):u.MAX_ORDINAL;return-1===i?u.MAX_ORDINAL:i}},{key:"compare",value:function(e,t){return this.getScore(e)-this.getScore(t)}}]),t}(),g=function(){function t(){e(o)(this,t)}return e(a)(t,[{key:"compare",value:function(e,t){return(e.order?e.order:u.MAX_ORDINAL)-(t.order?t.order:u.MAX_ORDINAL)}}],[{key:"Instance",get:function(){return this.INSTANCE||(this.INSTANCE=new this)}}]),t}(),k=function(){function t(){e(o)(this,t)}return e(a)(t,[{key:"compare",value:function(e,t){return e.shortName.localeCompare(t.shortName)}}],[{key:"Instance",get:function(){return this.INSTANCE||(this.INSTANCE=new this)}}]),t}()})),r("41EFR",(function(r,n){t(r.exports,"UsageFrequencyTracker",(function(){return p}));var o=i("uqRmf"),a=i("eVDe4"),s=i("kFnE9"),u=i("cODgg"),c=i("hu37m"),h=i("jkNiB"),d=i("fzGgz"),f=i("ax6lg");function l(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function m(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?l(Object(r),!0).forEach((function(i){e(s)(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var p=function(){function t(){var i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e(o)(this,t);var r=t.queueOptions;if(i&&r.storage){var n=m(m({},r),{},{storage:r.storage});this.queue=new(0,d.default)(n)}else this.queue=new(0,h.default)(r);this.gateway=new v(10)}return e(a)(t,[{key:"recordUsage",value:function(e){var t=this,i=e.id;i&&((0,u.isEmojiVariationDescription)(e)&&(i=e.baseId),this.gateway.submit((function(){i&&t.queue.enqueue(i)})))}},{key:"getOrder",value:function(){return this.queue.getItemsOrderedByDuplicateCount()}},{key:"clear",value:function(){this.queue.clear()}}]),t}();e(s)(p,"queueOptions",{storage:(0,f.default)("localStorage")?window.localStorage:void 0,storagePrefix:c.localStoragePrefix,maxDuplicates:25,minUniqueItems:5});var v=function(){function t(i){if(e(o)(this,t),i<1)throw new RangeError("The maximumPermitted parameter must be 1 or more.");this.maximumPermitted=i,this.count=0}return e(a)(t,[{key:"submit",value:function(e){var t=this;if(this.count>=this.maximumPermitted)return!1;this.count++;return"undefined"!=typeof window&&window.setTimeout((function(){try{e()}finally{t.completed()}})),!0}},{key:"completed",value:function(){this.count--}}]),t}()})),r("jkNiB",(function(r,n){t(r.exports,"default",(function(){return s}));var o=i("uqRmf"),a=i("eVDe4"),s=function(){function t(i){if(e(o)(this,t),i.maxDuplicates<1)throw new RangeError("The maxDuplicates option must be at least 1");if(i.minUniqueItems<1)throw new RangeError("The minUniqueItems option must be at least 1");this.maximumSize=i.maxDuplicates*i.minUniqueItems,this.perItemSize=i.maxDuplicates,this.createEmptyState()}return e(a)(t,[{key:"enqueue",value:function(e){this.enqueueWithoutOrdering(e),this.itemsOrderedByFrequency=this.orderItemsByFrequency()}},{key:"getItemsOrderedByDuplicateCount",value:function(){return this.itemsOrderedByFrequency}},{key:"clear",value:function(){this.createEmptyState()}},{key:"bulkEnqueue",value:function(e){var t=this;e.map((function(e){return t.enqueueWithoutOrdering(e)})),this.itemsOrderedByFrequency=this.orderItemsByFrequency()}},{key:"getItems",value:function(){return this.items}},{key:"createEmptyState",value:function(){this.items=new Array,this.itemCountMap=new Map,this.itemsOrderedByFrequency=new Array}},{key:"enqueueWithoutOrdering",value:function(e){var t=this.itemCountMap.get(e);t&&t>=this.perItemSize?this.removeFirstOccurrence(e):this.items.length>=this.maximumSize&&this.remove(),this.add(e)}},{key:"orderItemsByFrequency",value:function(){return Array.from(this.itemCountMap.entries()).sort((function(e,t){return t[1]-e[1]})).map((function(e){return e[0]}))}},{key:"decrementCount",value:function(e){var t=this.itemCountMap.get(e);t&&(--t>0?this.itemCountMap.set(e,t):this.itemCountMap.delete(e))}},{key:"removeFirstOccurrence",value:function(e){var t=this.items.indexOf(e);-1!==t&&(this.items.splice(t,1),this.decrementCount(e))}},{key:"remove",value:function(){var e=this.items.shift();return void 0!==e&&this.decrementCount(e),e}},{key:"add",value:function(e){this.items.push(e);var t=this.itemCountMap.get(e);t?this.itemCountMap.set(e,t+1):this.itemCountMap.set(e,1)}}]),t}()})),r("fzGgz",(function(r,n){t(r.exports,"default",(function(){return v}));var o=i("uqRmf"),a=i("eVDe4"),s=i("h4cnL"),u=i("3BD5g"),c=i("ck3YL"),h=i("lH0U2"),d=i("kFnE9"),f=i("jkNiB"),l=i("akORO");function m(t){var i=p();return function(){var r,n=e(h)(t);if(i){var o=e(h)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return e(c)(this,r)}}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(p=function(){return!!e})()}var v=function(t){e(u)(r,t);var i=m(r);function r(t){var n;return e(o)(this,r),(n=i.call(this,t)).storage=t.storage,n.prefixedStorageKey="".concat(t.storagePrefix,".").concat(r.storageKey),n.load(),n}return e(a)(r,[{key:"enqueue",value:function(t){e(s)(e(h)(r.prototype),"enqueue",this).call(this,t),this.save()}},{key:"clear",value:function(){e(s)(e(h)(r.prototype),"clear",this).call(this),this.storage.removeItem(this.prefixedStorageKey)}},{key:"load",value:function(){var e=this.storage.getItem(this.prefixedStorageKey);if(e)try{var t=JSON.parse(e);this.bulkEnqueue(t)}catch(e){(0,l.default)("Error parsing the queue stored as ".concat(this.prefixedStorageKey," key from storage"),e)}}},{key:"save",value:function(){var e=JSON.stringify(this.getItems());try{this.storage.setItem(this.prefixedStorageKey,e)}catch(e){(0,l.default)("Error saving the queued items as ".concat(this.prefixedStorageKey),e)}}}]),r}(f.default);e(d)(v,"storageKey","lastUsed")})),r("aNiAa",(function(r,n){t(r.exports,"default",(function(){return w}));var o=i("9q1kH"),a=i("4mVfk"),s=i("lOQkO"),u=i("uqRmf"),c=i("eVDe4"),h=i("kFnE9"),d=i("8DpVo"),f=i("dClYm"),l=i("kWY6l"),m=i("cODgg"),p=i("6YyCt"),v=i("aRoNj"),y=i("a4WeZ"),g=i("akORO"),k=i("76wh7"),j=["altRepresentations"];function R(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function E(t){for(var i=1;i<arguments.length;i++){var r=null!=arguments[i]?arguments[i]:{};i%2?R(Object(r),!0).forEach((function(i){e(h)(t,i,r[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var w=function(){function t(i,r){var n=this;e(u)(this,t),e(h)(this,"postToEmojiService",(function(t,i){var r=t.shortName,o=t.name,a=t.width,u=t.height,c={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({shortName:r,name:o,width:a,height:u,fileId:i})};return f.utils.requestService(n.siteServiceConfig,{requestInit:c}).then((function(t){var i=t.emojis;if(i.length){var r=i[0],n=r.altRepresentations,o=e(s)(r,j),a=E(E({},o),{},{representation:(0,m.convertImageToMediaRepresentation)(o.representation)}),u=(0,v.getAltRepresentation)(n||{}),c=u?(0,m.convertImageToMediaRepresentation)(u):void 0;return(0,m.buildEmojiDescriptionWithAltRepresentation)(a,c)}throw new Error("No emoji returns from upload. Upload failed.")}))})),this.siteServiceConfig=i,this.mediaApiToken=r,this.tokenManager=new(0,y.default)(i),this.tokenManager.addToken("read",r),this.mediaEmojiCache=new(0,p.default)(this.tokenManager)}var i;return e(c)(t,[{key:"generateTokenisedMediaURLS",value:(i=e(a)(e(d).mark((function t(i,r){var n;return e(d).wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((0,m.isMediaRepresentation)(i)){t.next=2;break}return t.abrupt("return",{representation:i,altRepresentation:r});case 2:return t.prev=2,t.next=5,this.tokenManager.getToken("read");case 5:return n=t.sent,t.abrupt("return",Object.entries({representation:i,altRepresentation:r}).reduce((function(t,i){var r=e(o)(i,2),a=r[0],s=r[1];if(s&&(0,m.isMediaRepresentation)(s)){var u=new URL(s.mediaPath),c=u.searchParams;c.get("token")!==n.jwt&&c.set("token",n.jwt),c.get("client")!==n.clientId&&c.set("client",n.clientId),t[a]=E(E({},s),{},{mediaPath:u.toString()})}return t}),{representation:i,altRepresentation:r}));case 9:return t.prev=9,t.t0=t.catch(2),t.abrupt("return",{representation:i,altRepresentation:r});case 12:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(e,t){return i.apply(this,arguments)})},{key:"loadMediaEmoji",value:function(e,t){if(!(0,m.isMediaEmoji)(e))throw new Error("Only supported for media emoji");return this.mediaEmojiCache.loadEmoji(e,t)}},{key:"optimisticRendering",value:function(e,t){var i=t?e.altRepresentation:e.representation;if(!(0,m.isMediaRepresentation)(i))throw new Error("Only supported for media emoji");var r=i.mediaPath;return this.mediaEmojiCache.optimisticRendering(r)}},{key:"uploadEmoji",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=Date.now();return this.tokenManager.getToken("upload",i).then((function(i){var o=Date.now()-n;return(0,g.default)("upload token load time",o),new Promise((function(a,s){var u=i.url,c=i.clientId,h=i.collectionName,d=(0,l.getMediaClient)({authProvider:function(){return Promise.resolve({clientId:c,token:i.jwt,baseUrl:u})},useSha256ForUploads:(0,k.isFedRamp)()}).file.upload({content:e.dataURL,name:e.filename,collection:h}).subscribe({next:function(i){if("uploading"===i.status&&r)r({percent:.95*i.progress});else if("processing"===i.status){d.unsubscribe();var u=Date.now()-n,c=u-o;(0,g.default)("total upload / media upload times",u,c),t.postToEmojiService(e,i.id).then((function(e){a(e)})).catch((function(e){s(e.reason||e)}))}},error:function(e){s(e)}})}))}))}},{key:"hasUploadToken",value:function(){return this.tokenManager.getToken("upload").then((function(e){return void 0!==e}),(function(){return!1}))}},{key:"prepareForUpload",value:function(){this.tokenManager.getToken("upload")}},{key:"findEmoji",value:function(e){if(!e.id)return Promise.reject(!1);var t="../".concat(encodeURIComponent(e.id));return(0,v.emojiRequest)(this.siteServiceConfig,{path:t}).then((function(e){return(0,v.denormaliseEmojiServiceResponse)(e).emojis[0]})).catch((function(t){(0,g.default)("failed to load emoji",e,t)}))}},{key:"deleteEmoji",value:function(e){if(!(0,m.isMediaEmoji)(e)&&!(0,m.isLoadedMediaEmoji)(e))return Promise.reject(!1);if(!e.id)return Promise.reject(!1);var t="".concat(encodeURIComponent(e.id));return f.utils.requestService(this.siteServiceConfig,{path:t,requestInit:{method:"DELETE"}}).then((function(){return!0})).catch((function(){return!1}))}}]),t}()})),r("6YyCt",(function(r,n){t(r.exports,"default",(function(){return p}));var o=i("uqRmf"),a=i("eVDe4"),s=i("kFnE9"),u=i("cODgg"),c=i("lHm5n"),h=i("akORO"),d=i("rE472"),f=function(e,t){return t?e.altRepresentation:e.representation},l=function(){function t(i){e(o)(this,t),e(s)(this,"cachedImageUrls",new Set),(0,h.default)("BrowserCacheStrategy"),this.mediaImageLoader=i}return e(a)(t,[{key:"loadEmoji",value:function(e,t){var i=this,r=f(e,t);if(!(0,u.isMediaRepresentation)(r))return e;var n=r.mediaPath;return this.cachedImageUrls.has(n)?e:this.mediaImageLoader.loadMediaImage(n).then((function(){return i.cachedImageUrls.add(n),e})).catch((function(){}))}},{key:"optimisticRendering",value:function(){return!0}}],[{key:"supported",value:function(e,t){return i=!!document.documentMode,r=!i&&!!window.StyleMedia,i||r?Promise.resolve(!1):t.loadMediaImage(e).then((function(){return new Promise((function(t){var i=new Image;i.addEventListener("load",(function(){t(!0)})),i.addEventListener("error",(function(){t(!1)})),i.src=e}))})).catch((function(){return!1}));var i,r}}]),t}(),m=function(){function t(i){e(o)(this,t),(0,h.default)("MemoryCacheStrategy"),this.mediaImageLoader=i,this.dataURLCache=new(0,d.LRUMap)(1e3)}return e(a)(t,[{key:"loadEmoji",value:function(e,t){var i=this,r=f(e,t);if(!(0,u.isMediaRepresentation)(r))return e;var n=r.mediaPath,o=this.dataURLCache.get(n);return o?(0,u.convertMediaToImageEmoji)(e,o,t):this.mediaImageLoader.loadMediaImage(n).then((function(r){var o=(0,u.convertMediaToImageEmoji)(e,r,t);return r.length<=1e4?i.dataURLCache.set(n,r):(0,h.default)("No caching as image is too large",r.length,r.slice(0,15),e.shortName),o})).catch((function(){}))}},{key:"optimisticRendering",value:function(){return!1}}]),t}(),p=function(){function t(i){e(o)(this,t),e(s)(this,"waitingInitUrls",[]),(0,h.default)("MediaEmojiCache"),this.mediaImageLoader=new(0,c.default)(i)}return e(a)(t,[{key:"loadEmoji",value:function(e,t){var i=f(e,t);if(!(0,u.isMediaRepresentation)(i))return e;var r=i.mediaPath,n=this.getCache(r);return(0,u.isPromise)(n)?n.then((function(i){return i.loadEmoji(e,t)})).catch((function(){})):n.loadEmoji(e,t)}},{key:"optimisticRendering",value:function(e){var t=this.getCache(e);return(0,u.isPromise)(t)?t.then((function(e){return e.optimisticRendering()})).catch((function(){return!1})):t.optimisticRendering()}},{key:"getCache",value:function(e){var t=this;return this.cache?this.cache:(this.waitingInitUrls.push(e),this.cacheLoading||(this.cacheLoading=this.initCache().then((function(e){return t.cache=e,t.cacheLoading=void 0,e})).catch((function(e){throw t.cacheLoading=void 0,e}))),this.cacheLoading)}},{key:"initCache",value:function(){var e=this,t=this.waitingInitUrls.pop();return t?l.supported(t,this.mediaImageLoader).then((function(t){return e.waitingInitUrls=[],e.cacheLoading=void 0,t?new l(e.mediaImageLoader):new m(e.mediaImageLoader)})).catch((function(){return e.initCache()})):Promise.reject("Unable to initialise cache based on provided url(s)")}}]),t}()})),r("lHm5n",(function(r,n){t(r.exports,"default",(function(){return c}));var o=i("uqRmf"),a=i("eVDe4"),s=i("kFnE9"),u=i("bRoZY"),c=function(){function t(i,r){e(o)(this,t),e(s)(this,"mediaImageQueue",[]),e(s)(this,"activeProcessing",0),e(s)(this,"pendingRequests",new Map),this.concurrentDownloadLimit=r&&r.concurrentDownloadLimit||16,this.tokenManager=i}return e(a)(t,[{key:"loadMediaImage",value:function(e){var t=this,i=this.pendingRequests.get(e);if(void 0!==i)return i;var r=new Promise((function(i,r){t.mediaImageQueue.push({url:e,resolve:i,reject:r}),t.processFromQueue()})).then((function(i){return t.pendingRequests.delete(e),i})).catch((function(i){throw t.pendingRequests.delete(e),i}));return this.pendingRequests.set(e,r),r}},{key:"getQueueSize",value:function(){return this.mediaImageQueue.length}},{key:"getActiveDownloads",value:function(){return this.activeProcessing}},{key:"processFromQueue",value:function(){for(var e=this,t=function(){e.activeProcessing++;var t=e.mediaImageQueue.shift(),i=t.url,r=t.resolve,n=t.reject;e.tokenManager.getToken("read",!1).then((function(t){e.requestMediaEmoji(i,t,!0).then((function(t){r(t),e.completedItem()})).catch((function(t){n(t),e.completedItem()}))})).catch((function(t){n(t),e.completedItem()}))};this.activeProcessing<this.concurrentDownloadLimit&&this.mediaImageQueue.length>0;)t()}},{key:"completedItem",value:function(){this.activeProcessing--,this.processFromQueue()}},{key:"delay",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"requestMediaEmoji",value:function(e,t,i){var r=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;return(0,u.imageAcceptHeader)().then((function(o){var a={headers:{Authorization:"Bearer ".concat(t.jwt),"X-Client-Id":t.clientId,Accept:o}};return fetch(e,a).then((function(o){if(404===o.status&&n>0)return r.delay(600/n).then((function(){return r.requestMediaEmoji(e,t,!1,n-1)}));if(403===o.status&&i)return r.tokenManager.getToken("read",!0).then((function(t){return r.requestMediaEmoji(e,t,!1)}));if(o.ok)return o.blob().then((function(e){return r.readBlob(e)}));throw new Error("Unable to load media image. Status=".concat(o.status," ").concat(o.statusText))}))}))}},{key:"readBlob",value:function(e){return new Promise((function(t,i){var r=new FileReader;r.addEventListener("load",(function(){return t(r.result)})),r.addEventListener("error",(function(){return i(r.error)})),r.readAsDataURL(e)}))}}]),t}()})),r("bRoZY",(function(e,i){t(e.exports,"getNaturalImageSize",(function(){return n})),t(e.exports,"parseImage",(function(){return o})),t(e.exports,"hasFileExceededSize",(function(){return a})),t(e.exports,"imageAcceptHeader",(function(){return s}));var r,n=function(e){return new Promise((function(t,i){var r=new Image;r.addEventListener("load",(function(){t({width:r.naturalWidth,height:r.naturalHeight})})),r.addEventListener("error",i),r.src=e}))},o=function(e){return new Promise((function(t,i){var r=new Image;r.onload=function(){return t({src:r.src})},r.onerror=function(){return i()},r.src=e}))},a=function(e){return e&&e.size>1048576},s=function(){return(void 0!==r?Promise.resolve(r):new Promise((function(e){var t=new Image,i=function(){r=2===t.height,e(r)};t.addEventListener("load",i),t.addEventListener("error",i),t.src="data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA"}))).then((function(e){return e?"image/webp,image/*,*/*;q=0.8":"image/*,*/*;q=0.8"}))}})),r("a4WeZ",(function(r,n){t(r.exports,"default",(function(){return u}));var o=i("uqRmf"),a=i("eVDe4"),s=i("dClYm"),u=function(){function t(i){e(o)(this,t),this.siteServiceConfig=i,this.tokens=new Map}return e(a)(t,[{key:"isValidToken",value:function(e){return Date.now()/1e3<e.expiresAt-30}},{key:"fetchNewToken",value:function(e){return s.utils.requestService(this.siteServiceConfig,{path:"token/".concat(e)})}},{key:"addToken",value:function(e,t){this.tokens.set(e,{mediaApiToken:t})}},{key:"getToken",value:function(e,t){var i=this.tokens.get(e);i||(i={},this.tokens.set(e,i));var r=i,n=r.mediaApiToken,o=r.activeTokenRefresh;return n&&this.isValidToken(n)&&!t?Promise.resolve(n):o||(i.activeTokenRefresh=this.fetchNewToken(e).then((function(e){return i.mediaApiToken=e,i.activeTokenRefresh=void 0,e})),i.activeTokenRefresh)}}]),t}()})),r("76wh7",(function(e,i){t(e.exports,"isFedRamp",(function(){return n}));var r="fedramp-moderate";function n(){var e,t=globalThis.MICROS_PERIMETER||globalThis.UNSAFE_ATL_CONTEXT_BOUNDARY;if(t)return t===r;var i=null===(e=globalThis.location)||void 0===e||null===(e=e.hostname)||void 0===e?void 0:e.match(/atlassian-us-gov-mod\.(com|net)|atlassian-us-gov\.(com|net)|atlassian-fex\.(com|net)|atlassian-stg-fedm\.(com|net)/);return!!i&&i.length>0}}))}();
//# sourceMappingURL=main.abdfbdd4.js.map
