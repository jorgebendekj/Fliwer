!function(){function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequirecbf3,i=n.register;i("iOZu8",(function(t,n){e(t.exports,"UFOExperienceState",(function(){return i}));var i={NOT_STARTED:{id:"NOT_STARTED",final:!0},STARTED:{id:"STARTED"},IN_PROGRESS:{id:"IN_PROGRESS"},BLOCKED:{id:"BLOCKED"},RECOVERED:{id:"RECOVERED"},SUCCEEDED:{id:"SUCCEEDED",final:!0,success:!0},SUCCEEDED_WAITING_FOR_DEPS:{id:"SUCCEEDED_WAITING_FOR_DEPS"},FAILED:{id:"FAILED",final:!0},ABORTED:{id:"ABORTED",final:!0}}})),i("e3YLo",(function(i,r){e(i.exports,"ufolog",(function(){return l})),e(i.exports,"ufowarn",(function(){return E}));var a=n("uqRmf"),s=n("eVDe4"),u=n("kFnE9"),o=function(){function e(){t(a)(this,e),t(u)(this,"enabled",!1)}return t(s)(e,[{key:"log",value:function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];this.enabled&&(t=console).log.apply(t,[e.UFOprefix].concat(i))}},{key:"warn",value:function(){for(var t,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];this.enabled&&(t=console).warn.apply(t,[e.UFOprefix].concat(i))}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}}]),e}();t(u)(o,"UFOprefix","[ufo\ud83d\udef8]");var c=new o,l=function(){c.log.apply(c,arguments)},E=function(){c.warn.apply(c,arguments)}})),i("j4pou",(function(i,r){e(i.exports,"UFOExperience",(function(){return E}));var a=n("eVDe4"),s=n("uqRmf"),u=n("3BD5g"),o=n("ck3YL"),c=n("lH0U2");function l(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,r=t(c)(e);if(n){var a=t(c)(this).constructor;i=Reflect.construct(r,arguments,a)}else i=r.apply(this,arguments);return t(o)(this,i)}}var E=function(e){t(u)(i,e);var n=l(i);function i(){return t(s)(this,i),n.apply(this,arguments)}return t(a)(i)}(n("jmAg4").UFOAbstractExperience)})),i("jmAg4",(function(i,r){e(i.exports,"UFOAbstractExperience",(function(){return R}));var a=n("b4Ivn"),s=n("4mVfk"),u=n("uqRmf"),o=n("eVDe4"),c=n("kFnE9"),l=n("8DpVo"),E=n("5m0MG"),f=n("4OBwF"),p=n("fIFbY"),d=n("e3YLo"),h=n("k11S6"),S=n("9MNmY"),O=n("naQRd"),b=n("kcAjL"),v=n("iOZu8"),m=n("jbBJ2"),x=n("kfurH");function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function T(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?D(Object(i),!0).forEach((function(n){t(c)(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):D(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}var _=function(){return(0,b.isWindowObjectAvailable)()&&window.document&&"visible"!==window.document.visibilityState?S.PageVisibleState.HIDDEN:S.PageVisibleState.VISIBLE},y=function(e){return void 0!==e?~~e:(0,O.roundPerfNow)()},R=function(){function e(n,i){var r=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t(u)(this,e),t(c)(this,"state",v.UFOExperienceState.NOT_STARTED),t(c)(this,"instanceId",null),t(c)(this,"parent",null),t(c)(this,"category",null),t(c)(this,"metadata",{}),t(c)(this,"onDoneCallbacks",[]),t(c)(this,"childExperiences",[]),t(c)(this,"explicitTimings",{}),t(c)(this,"isSSROutputAsFMP",!1),t(c)(this,"uuid",null),t(c)(this,"_until",null),t(c)(this,"metrics",{startTime:null,endTime:null,marks:[]}),t(c)(this,"performanceConfig",{}),t(c)(this,"setPageVisibleStateToMixed",(function(){r.pageVisibleState=S.PageVisibleState.MIXED,h.visibilityChangeObserver.unsubscribe(r.setPageVisibleStateToMixed)})),this.id=n,this.category=(null==i?void 0:i.category)||null,this.until=(null==i?void 0:i.until)||null,this.instanceId=a,this.handleDoneBind=this._handleDoneExperience.bind(this),this.type=i.type,this.performanceType=i.performanceType,this.performanceConfig=i.performanceConfig||{},this.config=i,this.pageVisibleState=_(),this.featureFlags=i.featureFlags||[],this.timings=i.timings||[],i.performanceType!==x.ExperiencePerformanceTypes.PageLoad&&i.performanceType!==x.ExperiencePerformanceTypes.PageSegmentLoad||(this.isSSROutputAsFMP=i.isSSROutputAsFMP||!1)}var n,i,r,O,b,D,R;return t(o)(e,[{key:"transition",value:(R=t(s)(t(l).mark((function e(n,i){var r;return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,d.ufolog)("async transition",this.id,this.state.id,n.id),!(0,m.canTransition)(this.state,n)){e.next=15;break}if((0,d.ufolog)("TRANSITION: ".concat(this.id," from ").concat(this.state.id," to ").concat(n.id," successful"),this.state.final,!n.final),n===v.UFOExperienceState.STARTED&&this._reset(),this.state.final&&!n.final&&(this.metrics.startTime=y(i),this.uuid=(0,E.v4)()),this.state=n,!n.final){e.next=14;break}return this.metrics.endTime=y(i),this._isManualStateEnabled()||(0,p.getGlobalEventStream)().push((0,p.unsubscribeEvent)(S.SUBSCRIBE_ALL,this.handleDoneBind)),e.next=11,this.exportData();case 11:r=e.sent,(0,d.ufolog)("this.parent",this.parent),(0,p.getGlobalEventStream)().push((0,p.experiencePayloadEvent)(r));case 14:return e.abrupt("return",!0);case 15:return(0,d.ufolog)("TRANSITION: ".concat(this.id," from ").concat(this.state.id," to ").concat(n.id," unsuccessful")),(0,d.ufowarn)("transition of ".concat(this.id," from ").concat(this.state," to ").concat(n," is not possible")),e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"start",value:(D=t(s)(t(l).mark((function e(n){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transition(v.UFOExperienceState.STARTED,n);case 2:e.sent&&(this.pageVisibleState=_(),h.visibilityChangeObserver.subscribe(this.setPageVisibleStateToMixed),this._isManualStateEnabled()||((0,d.ufolog)("subscribed",this.id),(0,p.getGlobalEventStream)().push((0,p.subscribeEvent)(S.SUBSCRIBE_ALL,this.handleDoneBind))));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"mark",value:function(e,t){e!==S.FMP_MARK&&e!==S.INLINE_RESPONSE_MARK?this._mark(e,t):(0,d.ufowarn)("please use markFMP or markInlineResponse for specialised marks")}},{key:"_mark",value:function(e,t){this.metrics.marks.push({name:e,time:y(t)}),this.transition(v.UFOExperienceState.IN_PROGRESS)}},{key:"markFMP",value:function(e){this._mark(S.FMP_MARK,e)}},{key:"markInlineResponse",value:function(e){this._mark(S.INLINE_RESPONSE_MARK,e)}},{key:"_isManualStateEnabled",value:function(){return null===this.until}},{key:"_validateManualState",value:function(){return!!this._isManualStateEnabled()||((0,d.ufowarn)('manual change of state not allowed as "until" is defined'),!1)}},{key:"switchToEndState",value:function(e,t){return null!=t&&t.force||this._validateManualState()?(null!=t&&t.metadata&&this.addMetadata(t.metadata),h.visibilityChangeObserver.unsubscribe(this.setPageVisibleStateToMixed),this.transition(e)):null}},{key:"success",value:(b=t(s)(t(l).mark((function e(n){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.switchToEndState(v.UFOExperienceState.SUCCEEDED,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return b.apply(this,arguments)})},{key:"failure",value:(O=t(s)(t(l).mark((function e(n){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.switchToEndState(v.UFOExperienceState.FAILED,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"abort",value:(r=t(s)(t(l).mark((function e(n){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.switchToEndState(v.UFOExperienceState.ABORTED,n));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"addMetadata",value:function(e){Object.assign(this.metadata,e)}},{key:"_handleDoneExperience",value:function(e){if((0,d.ufolog)("_handleDoneExperience in",this.id,e.state,e,this._until),e.state.final&&null!==this._until){var t=this._until(e),n=t.done,i=t.state;n&&!this.state.final&&this.transition(i)}}},{key:"getId",value:(i=t(s)(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.id);case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"exportData",value:(n=t(s)(t(l).mark((function e(){return t(l).wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getId();case 2:return e.t0=e.sent,e.t1=this.uuid,e.t2=this.type,e.t3=f.UFO_EXPERIMENTAL_BUILD_VERSION||"unknown",e.t4=this.performanceType,e.t5=this.category,e.t6=this.state,e.t7=T({},this.metadata),e.t8=T({},this.metrics),e.t9=t(a)(this.childExperiences),e.t10={success:!!this.state.success,startTime:this.metrics.startTime,duration:(this.metrics.endTime||0)-(this.metrics.startTime||0)},e.t11=this.config.platform||null,e.t12=this.pageVisibleState,e.t13=this.featureFlags,e.t14=this.isSSROutputAsFMP,e.t15=this.timings,e.t16=this.explicitTimings,e.t17=this.performanceConfig,e.abrupt("return",{id:e.t0,uuid:e.t1,type:e.t2,schemaVersion:e.t3,performanceType:e.t4,category:e.t5,state:e.t6,metadata:e.t7,metrics:e.t8,children:e.t9,result:e.t10,platform:e.t11,pageVisibleState:e.t12,featureFlags:e.t13,isSSROutputAsFMP:e.t14,timings:e.t15,explicitTimings:e.t16,performanceConfig:e.t17});case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_reset",value:function(){this.parent=null,this.metadata={},this.onDoneCallbacks=[],this.childExperiences=[],this.metrics={startTime:null,endTime:null,marks:[]},this._until=this.until?this.until():null}}]),e}()})),i("4OBwF",(function(t,n){e(t.exports,"UFO_EXPERIMENTAL_BUILD_VERSION",(function(){return i}));var i="0.1.5"})),i("fIFbY",(function(t,i){e(t.exports,"getGlobalEventStream",(function(){return a})),e(t.exports,"subscribeEvent",(function(){return s})),e(t.exports,"unsubscribeEvent",(function(){return u})),e(t.exports,"experiencePayloadEvent",(function(){return o}));n("e3YLo");var r=n("9MNmY"),a=function(){if(!globalThis.__UFO_GLOBAL_EVENT_STREAM__){var e=(t=[],{__buffer_only__:!0,push:function(e){t.length<250&&t.push(e)},getStream:function(){return t}});globalThis.__UFO_GLOBAL_EVENT_STREAM__=e}var t;return globalThis.__UFO_GLOBAL_EVENT_STREAM__},s=function(e,t){return{type:r.UFOGlobalEventStreamEventType.SUBSCRIBE,payload:{experienceId:e,callback:t}}},u=function(e,t){return{type:r.UFOGlobalEventStreamEventType.UNSUBSCRIBE,payload:{experienceId:e,callback:t}}},o=function(e){return{type:r.UFOGlobalEventStreamEventType.EXPERIENCE_PAYLOAD,payload:e}}})),i("9MNmY",(function(t,n){e(t.exports,"UFOGlobalEventStreamEventType",(function(){return i})),e(t.exports,"PageVisibleState",(function(){return r})),e(t.exports,"SUBSCRIBE_ALL",(function(){return a})),e(t.exports,"FMP_MARK",(function(){return s})),e(t.exports,"INLINE_RESPONSE_MARK",(function(){return u}));var i=function(e){return e[e.EXPERIENCE_PAYLOAD=0]="EXPERIENCE_PAYLOAD",e[e.SUBSCRIBE=1]="SUBSCRIBE",e[e.UNSUBSCRIBE=2]="UNSUBSCRIBE",e}({}),r=function(e){return e.VISIBLE="visible",e.HIDDEN="hidden",e.MIXED="mixed",e}({}),a="__SUBSCRIBE_ALL__",s="fmp",u="inline-response"})),i("k11S6",(function(i,r){e(i.exports,"visibilityChangeObserver",(function(){return c}));var a=n("uqRmf"),s=n("eVDe4"),u=n("kFnE9"),o=n("kcAjL"),c=new(function(){function e(){var n=this;t(a)(this,e),t(u)(this,"started",!1),t(u)(this,"observers",[]),t(u)(this,"broadcast",(function(){n.observers.forEach((function(e){return e()})),n.observers=[]}))}return t(s)(e,[{key:"start",value:function(){this.started||(this.started=!0,document.addEventListener("visibilitychange",this.broadcast),(0,o.isWindowObjectAvailable)()&&window.addEventListener("pagehide",this.broadcast))}},{key:"subscribe",value:function(e){this.observers.push(e)}},{key:"unsubscribe",value:function(e){this.observers=this.observers.filter((function(t){return t!==e}))}}]),e}())})),i("kcAjL",(function(t,n){e(t.exports,"isWindowObjectAvailable",(function(){return i}));var i=function(){return"undefined"!=typeof window}})),i("naQRd",(function(t,n){e(t.exports,"roundPerfNow",(function(){return i}));var i=function(){return~~performance.now()}})),i("jbBJ2",(function(i,r){e(i.exports,"canTransition",(function(){return c}));var a,s=n("kFnE9"),u=n("iOZu8"),o=(a={},t(s)(a,u.UFOExperienceState.NOT_STARTED.id,[u.UFOExperienceState.STARTED.id]),t(s)(a,u.UFOExperienceState.STARTED.id,[u.UFOExperienceState.IN_PROGRESS.id,u.UFOExperienceState.BLOCKED.id,u.UFOExperienceState.SUCCEEDED.id,u.UFOExperienceState.SUCCEEDED_WAITING_FOR_DEPS.id,u.UFOExperienceState.FAILED.id,u.UFOExperienceState.ABORTED.id]),t(s)(a,u.UFOExperienceState.IN_PROGRESS.id,[u.UFOExperienceState.BLOCKED.id,u.UFOExperienceState.SUCCEEDED.id,u.UFOExperienceState.SUCCEEDED_WAITING_FOR_DEPS.id,u.UFOExperienceState.FAILED.id,u.UFOExperienceState.ABORTED.id]),t(s)(a,u.UFOExperienceState.BLOCKED.id,[u.UFOExperienceState.RECOVERED.id,u.UFOExperienceState.ABORTED.id]),t(s)(a,u.UFOExperienceState.RECOVERED.id,[u.UFOExperienceState.STARTED.id,u.UFOExperienceState.SUCCEEDED.id,u.UFOExperienceState.SUCCEEDED_WAITING_FOR_DEPS.id,u.UFOExperienceState.FAILED.id,u.UFOExperienceState.ABORTED.id]),t(s)(a,u.UFOExperienceState.SUCCEEDED.id,[u.UFOExperienceState.STARTED.id]),t(s)(a,u.UFOExperienceState.SUCCEEDED_WAITING_FOR_DEPS.id,[u.UFOExperienceState.SUCCEEDED.id,u.UFOExperienceState.FAILED.id,u.UFOExperienceState.ABORTED.id]),t(s)(a,u.UFOExperienceState.FAILED.id,[u.UFOExperienceState.STARTED.id]),t(s)(a,u.UFOExperienceState.ABORTED.id,[u.UFOExperienceState.STARTED.id]),a),c=function(e,t){return o[e.id]&&o[e.id].includes(t.id)}})),i("kfurH",(function(t,n){e(t.exports,"ExperienceTypes",(function(){return i})),e(t.exports,"ExperiencePerformanceTypes",(function(){return r}));var i=function(e){return e.Load="load",e.Experience="experience",e.Operation="operation",e}({}),r=function(e){return e.PageLoad="page-load",e.PageSegmentLoad="page-segment-load",e.InlineResult="inline-result",e.Custom="custom",e}({})}))}();
//# sourceMappingURL=esm.87bf6e88.js.map
